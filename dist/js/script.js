var maxSumm=6e6,minSumm=0,startSumm=1e5,maxRefill=1e6,minRefill=0,startRefill=2e4,maxTerm=24,minTerm=1,startTerm=12,rate=5.5;function calcDeposit(e,r,t,l){function a(e){return Number(String(e).replace(/[^0-9]/g,""))}e=a(e),r=a(r),l=a(l);for(var m=t/12,c=e,i=0;i<l;i++)refill=i==l-1?0:r,c+=c*m/100+refill;var n=c-(e+r*(l-1));return{depo:c=Math.round(c),perc:n=Math.round(n)}}function diagramm(e,r,t,l){function a(e){return Math.PI/180*e}function m(e,r,t,l,a){d.strokeStyle=e,d.lineWidth=r,d.beginPath(),d.arc(150,150,t,0,l,a),d.stroke()}var c=document.getElementById(e),i=a(360),n=a(r),u=a(t),s=a(l),d=c.getContext("2d");d.clearRect(0,0,300,300),m("#cccccc",1,139,i,!1),m("#D8D8D8",6,137,-n,!0),m("#979797",6,137,u,!1),m("#FC6B08",16,132,-s,!0)}function getSliders(){var e=$("#bcalc_inputSummLabel").val(),r=$("#bcalc_inputRefillLabel").val(),t=$("#bcalc_inputTermLabel").val();return{start:Number(String(e).replace(/[^0-9]/g,"")),refill:Number(String(r).replace(/[^0-9]/g,"")),term:Number(String(t).replace(/[^0-9]/g,""))}}function setInputVal(e,r,t){var l=$("#bcalc_inputSummLabel"),a=$("#bcalc_inputRefillLabel"),m=$("#bcalc_inputTermLabel");l.attr("value",e),a.attr("value",r),m.attr("value",t)}function createSlides(e,r,a,m,t,l,c,i){var n=document.getElementById(e),u=document.getElementById(r);slideRange=c?{min:[a],"33%":[1e5,l],"66%":[m/4,l],max:[m]}:{min:a,max:m},noUiSlider.create(n,{connect:[!0,!1],behaviour:"tap",step:l,start:t,range:slideRange}),n.noUiSlider.on("slide",function(e,r){var t=Math.round(e[r]);u.value=numDevider(t);var l=getSliders(),a=calcDeposit(l.start,l.refill,i,l.term);console.log(month(l.term)),$(".bcalc__resultTermNum").text(month(l.term)),$(".bcalc__resultSumm").text(numDevider(a.depo));var m=l.start+l.refill*l.term;summPerc=100*l.start/m,summDeg=3.6*summPerc,refillPerc=l.refill*l.term*100/m,refillDeg=3.6*refillPerc,percPerc=100*a.perc/m,percDeg=3.6*percPerc,diagramm("bcalc__diagrammCanvas",summDeg,refillDeg,percDeg)}),u.addEventListener("change",function(){var e=Number(this.value.replace(/[^0-9]/g,""));m<e&&(e=m),e<a&&(e=a),this.value=numDevider(e),n.noUiSlider.set([e,null]);var r=getSliders(),t=calcDeposit(r.start,r.refill,i,r.term);$(".bcalc__resultTermNum").text(month(r.term)),$(".bcalc__resultSumm").text(numDevider(t.depo));var l=r.start+r.refill*r.term;summPerc=100*r.start/l,summDeg=3.6*summPerc,refillPerc=r.refill*r.term*100/l,refillDeg=3.6*refillPerc,percPerc=100*t.perc/l,percDeg=3.6*percPerc,diagramm("bcalc__diagrammCanvas",summDeg,refillDeg,percDeg)})}function numDevider(e){return String(e).replace(/[^0-9]/g,"").replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}function month(e){var r=e+" месяц";return-1<$.inArray(e,[11,12,13,14])?r+="ев":(-1<$.inArray(e%10,[2,3,4])&&(r+="а"),-1<$.inArray(e%10,[0,5,6,7,8,9])&&(r+="ев")),r}var summInput=$("#bcalc_inputSumm"),refillInput=$("#bcalc_refill"),termInput=$("#bcalc_inputTerm");createSlides("bcalc_inputSumm","bcalc_inputSummLabel",minSumm,maxSumm,startSumm,1e3,!0,rate),createSlides("bcalc_inputRefill","bcalc_inputRefillLabel",minRefill,maxRefill,startRefill,1e3,!0,rate),createSlides("bcalc_inputTerm","bcalc_inputTermLabel",minTerm,maxTerm,startTerm,1,!1,rate),$(document).ready(function(){setInputVal(numDevider(startSumm),numDevider(startRefill),numDevider(startTerm));var e=getSliders(),r=calcDeposit(e.start,e.refill,rate,e.term);$(".calcdepo__percval").text(numDevider(r.perc)),$(".calcdepo__termval").text(e.term),$(".bcalc__resultTermNum").text(month(e.term)),$(".bcalc__resultSumm").text(numDevider(r.depo));var t=e.start+e.refill*e.term;summPerc=100*e.start/t,summDeg=3.6*summPerc,refillPerc=e.refill*e.term*100/t,refillDeg=3.6*refillPerc,percPerc=100*r.perc/t,percDeg=3.6*percPerc,diagramm("bcalc__diagrammCanvas",summDeg,refillDeg,percDeg)});